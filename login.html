
<html>
<head>
<title>Statiz | Login</title>
<link rel="stylesheet" href="styles/navbar.css">
<link rel="stylesheet" href="styles/login.css">
<script src="scripts/auth.js"></script>
</head>

<body>

<div class="box">
  <button id="themeToggle" class="theme-btn-login">☀️</button>
  <h2 id="formTitle">Statiz Login</h2>
  <input id="nameInput" type="text" placeholder="Full Name" style="display:none;">
  <input id="emailInput" type="email" placeholder="Email">
  <input id="passwordInput" type="password" placeholder="Password">
  <button id="submitBtn">Login</button>
  <button id="toggleBtn">Create Account</button>
  <a href="index.html">Continue as Guest</a>
</div>

<script>
const API = 'http://localhost:3000';
let isRegisterMode = false;

const formTitle = document.getElementById('formTitle');
const nameInput = document.getElementById('nameInput');
const emailInput = document.getElementById('emailInput');
const passwordInput = document.getElementById('passwordInput');
const submitBtn = document.getElementById('submitBtn');
const toggleBtn = document.getElementById('toggleBtn');

toggleBtn.addEventListener('click', () => {
  isRegisterMode = !isRegisterMode;
  if (isRegisterMode) {
    formTitle.textContent = 'Create Account';
    nameInput.style.display = 'block';
    submitBtn.textContent = 'Register';
    toggleBtn.textContent = 'Back to Login';
  } else {
    formTitle.textContent = 'Statiz Login';
    nameInput.style.display = 'none';
    submitBtn.textContent = 'Login';
    toggleBtn.textContent = 'Create Account';
  }
});

async function login() {
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();

  if (!email || !password) {
    alert('Please enter email and password');
    return;
  }

  try {
    const adminRes = await fetch(`${API}/admin?email=${email}&password=${password}`);
    const admin = await adminRes.json();
    
    if (admin && admin.length > 0) {
      localStorage.setItem('isAdmin', 'true');
      localStorage.setItem('userEmail', email);
      window.location.href = 'admin.html';
      return;
    }

    const userRes = await fetch(`${API}/users?email=${email}&password=${password}`);
    const users = await userRes.json();
    
    if (users && users.length > 0) {
      localStorage.setItem('userEmail', email);
      localStorage.setItem('userName', users[0].name);
      window.location.href = 'index.html';
    } else {
      alert('Invalid email or password');
    }
  } catch (error) {
    alert('Error: Could not connect to server. Make sure json-server is running on http://localhost:3000');
  }
}

async function register() {
  const name = nameInput.value.trim();
  const email = emailInput.value.trim();
  const password = passwordInput.value.trim();

  if (!name || !email || !password) {
    alert('Please fill all fields');
    return;
  }

  try {
    const checkRes = await fetch(`${API}/users?email=${email}`);
    const existingUsers = await checkRes.json();
    
    if (existingUsers && existingUsers.length > 0) {
      alert('Email already registered');
      return;
    }

    const res = await fetch(`${API}/users`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, email, password })
    });

    if (res.ok) {
      alert('Account created successfully! You can now login.');
      isRegisterMode = false;
      toggleBtn.click();
      nameInput.value = '';
      emailInput.value = '';
      passwordInput.value = '';
    } else {
      alert('Registration failed');
    }
  } catch (error) {
    alert('Error: Could not connect to server. Make sure json-server is running.');
  }
}

submitBtn.addEventListener('click', () => {
  if (isRegisterMode) {
    register();
  } else {
    login();
  }
});

passwordInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    if (isRegisterMode) register();
    else login();
  }
});
</script>

<script src="scripts/navbar.js"></script>
</body>
</html>
